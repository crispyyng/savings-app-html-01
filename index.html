<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Money App</title>
    
    <!-- 1. Tailwind CSS for design -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM Core -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel for compiling JSX directly in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. Import Map: This tells the browser exactly how to resolve your Firebase and React imports -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18",
            "react-dom/client": "https://esm.sh/react-dom@18/client",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
            "firebase/analytics": "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"
        }
    }
    </script>
    <style>
        body { margin: 0; padding: 0; background-color: #f9fafb; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- data-type="module" is required so your "import" statements work seamlessly -->
    <script type="text/babel" data-type="module">
        import { createRoot } from 'react-dom/client';
        
        // =======================================================================================
       import React, { useState, useEffect, useMemo } from 'react';
import { initializeApp } from 'firebase/app';
import { getAnalytics } from "firebase/analytics";
import { 
  getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged,
  GoogleAuthProvider, signInWithPopup, signOut
} from 'firebase/auth';
import { 
  getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc
} from 'firebase/firestore';

// ==========================================
// 1. Firebase & Ê†∏ÂøÉË®≠ÂÆö
// ==========================================


// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyD5iLIBqMK__fqyRUObXnO9S55Rne0gQnY",
  authDomain: "my-savings-app-138fd.firebaseapp.com",
  projectId: "my-savings-app-138fd",
  storageBucket: "my-savings-app-138fd.firebasestorage.app",
  messagingSenderId: "610693434561",
  appId: "1:610693434561:web:00221b38ee48d3cb875840",
  measurementId: "G-4FV1FGDX28"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

// --- Â§öÂúãË™ûË®ÄÂ≠óÂÖ∏ ---
const dict = {
  zh: {
    appTitle: "ÂÑ≤ËìÑÂä©Êâã",
    home: "Êó•Â∏∏", wishlist: "ÂøÉÈ°ò", analysis: "ÂàÜÊûê", settings: "Ë®≠ÂÆö",
    dailyBudget: "ÊØèÊó•È†êÁÆó", todaySpent: "‰ªäÊó•Â∑≤Ëä±", todayRemaining: "‰ªäÊó•Ââ©È§òÈ†êÁÆó", cumulativeSurplus: "Á¥ØÁ©çÂèØÁî®ÁõàÈ§ò",
    aiEntryTitle: "ü§ñ AI Êô∫ËÉΩË®òÂ∏≥", aiPlaceholder: "‰æãÂ¶ÇÔºöÂ∞ãÊó•È£üÈ∫•Áï∂ÂãûÁî®Âíó50Ëöä...", aiBtn: "AI ÂàÜÊûê",
    manualEntryTitle: "üí∏ ÊâãÂãïË®òÂ∏≥",
    itemName: "È†ÖÁõÆÂêçÁ®±", amount: "ÈáëÈ°ç", category: "ÂàÜÈ°û", note: "ÂÇôË®ª (ÈÅ∏Â°´)", saveBtn: "ÂÑ≤Â≠òÁ¥ÄÈåÑ",
    todayDetails: "‰ªäÊó•ÊòéÁ¥∞",
    wishDesc: "‰Ω†ÊÉ≥Ë¶Å‰ªÄÈ∫ºÂë¢Ôºü", wishPrice: "È†ê‰º∞ÈáëÈ°ç $", wishMeaning: "ÈÄô‰ªΩÂøÉÈ°òÂ∞ç‰Ω†ÁöÑÊÑèÁæ©ÊòØÔºü", wishBtn: "Ë®±‰∏ãÂøÉÈ°ò",
    wishShowTier: "È°ØÁ§∫Â±§Á¥ö", wishEmpty: "ÁõÆÂâçÊ≤íÊúâÁ¨¶ÂêàÊ≠§Â±§Á¥öÁöÑÂøÉÈ°ò",
    analysisTitle: "Êï∏ÊìöÂàÜÊûê", quickSelect: "Âø´ÈÄüÈÅ∏Êìá", today: "‰ªäÊó•", thisWeek: "Êú¨ÈÄ±", thisMonth: "Êú¨Êúà",
    customRange: "Ëá™Ë®ÇÂçÄÈñì", to: "Ëá≥",
    totalSpentRange: "ÂçÄÈñìÁ∏ΩËä±Ë≤ª", chartCategory: "ÂàÜÈ°ûÂç†ÊØî (Èï∑Ê¢ùÂúñ)", chartTrend: "ÊØèÊó•Ë∂®Âã¢ (ÊäòÁ∑öÂúñ)",
    settingsTitle: "ÂÄã‰∫∫Ë®≠ÂÆö",
    nickname: "Êö±Á®±", langSelect: "Ë™ûË®Ä / Language",
    baseDate: "Ë®àÁÆóËµ∑ÂßãÊó•", baseBalance: "Ëµ∑ÂßãÊó•È§òÈ°ç ($)",
    cloudBackup: "Èõ≤Á´ØÂÇô‰ªΩËàáÂ∏≥Ëôü", guest: "Ë®™ÂÆ¢‰ΩøÁî®ËÄÖ", localOnly: "Ë≥áÊñôÂÉÖÊö´Â≠òÊñºÊú¨Ë®≠ÂÇô", loginGoogle: "ÈÄ£Áµê Google Â∏≥Ëôü", logout: "ÁôªÂá∫Â∏≥Ëôü",
    categories: ["Âü∫Êú¨ÁîüÊ¥ª", "Á§æ‰∫§/Â®õÊ®Ç", "Á™ÅÁôº/Á∑äÊÄ•", "Âõ∫ÂÆöÊîØÂá∫", "ÂÖ∂‰ªñ"],
    wishTiers: [
      { level: 1, label: 'üåø Ê∫´ÊüîÁöÑÂøÖÈúÄ', desc: 'ÁÖßÈ°ßÂ•ΩËá™Â∑±ÁöÑÂü∫Áü≥' },
      { level: 2, label: 'üíñ ÊÄ¶ÁÑ∂ÁöÑÂøÉÂãï', desc: 'ÁÇ∫Êó•Â∏∏Â∏∂‰æÜÁ¥îÁ≤πÂø´Ê®Ç' },
      { level: 3, label: '‚òÅÔ∏è Èö®Á∑£ÁöÑÊúüÁõº', desc: 'ÊúâÂæàÂ•ΩÔºåÊ≤íÊúâ‰πüÁÑ°Â¶®' }
    ]
  },
  en: {
    appTitle: "Savings Assistant",
    home: "Home", wishlist: "Wishlist", analysis: "Analysis", settings: "Settings",
    dailyBudget: "Daily Budget", todaySpent: "Today Spent", todayRemaining: "Today Remaining", cumulativeSurplus: "Cumulative Surplus",
    aiEntryTitle: "ü§ñ AI Smart Entry", aiPlaceholder: "e.g., spent 50 on Mcdonalds yesterday...", aiBtn: "AI Parse",
    manualEntryTitle: "üí∏ Manual Entry",
    itemName: "Item Name", amount: "Amount", category: "Category", note: "Note (Opt)", saveBtn: "Save",
    todayDetails: "Today's Details",
    wishDesc: "What do you desire?", wishPrice: "Est. Price $", wishMeaning: "What does this mean to you?", wishBtn: "Make a Wish",
    wishShowTier: "Show Tiers", wishEmpty: "No wishes in selected tiers",
    analysisTitle: "Data Analysis", quickSelect: "Quick Select", today: "Today", thisWeek: "This Week", thisMonth: "This Month",
    customRange: "Custom Range", to: "to",
    totalSpentRange: "Total Spent", chartCategory: "Category Breakdown", chartTrend: "Daily Trend",
    settingsTitle: "Personal Settings",
    nickname: "Nickname", langSelect: "Language / Ë™ûË®Ä",
    baseDate: "Starting Date", baseBalance: "Starting Balance ($)",
    cloudBackup: "Cloud Backup & Account", guest: "Guest User", localOnly: "Data saved locally only", loginGoogle: "Link Google Account", logout: "Logout",
    categories: ["Living", "Social/Fun", "Emergency", "Fixed", "Other"],
    wishTiers: [
      { level: 1, label: 'üåø Gentle Necessity', desc: 'Cornerstone of self-care' },
      { level: 2, label: 'üíñ Heart-fluttering', desc: 'Pure joy for daily life' },
      { level: 3, label: '‚òÅÔ∏è Serendipitous', desc: 'Nice to have, fine without' }
    ]
  }
};

// ==========================================
// 2. ‰∏ªÊáâÁî®Á®ãÂºèÂÖÉ‰ª∂
// ==========================================
export default function App() {
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState('home');
  const [isLoading, setIsLoading] = useState(true);

  // Ë≥áÊñôÁãÄÊÖã
  const [expenses, setExpenses] = useState([]);
  const [wishlist, setWishlist] = useState([]);
  
  // Ë®≠ÂÆöÁãÄÊÖã (ÂåÖÂê´Èö±ËóèË®≠ÂÆöËàáËàäÁâàË¶ÅÊ±Ç)
  const [config, setConfig] = useState({ 
    dailyLimit: 500,
    language: 'zh',
    nickname: '',
    baseDate: new Date().toISOString().split('T')[0],
    baseBalance: 0
  });

  const t = dict[config.language] || dict.zh;

  // È°òÊúõÊ∏ÖÂñÆÁØ©ÈÅ∏ÁãÄÊÖã (È†êË®≠ÂÖ®ÈÅ∏)
  const [activeTierFilters, setActiveTierFilters] = useState([1, 2, 3]);

  // Ë°®ÂñÆÁãÄÊÖã
  const todayDateStr = new Date().toISOString().split('T')[0];
  const [newExpense, setNewExpense] = useState({ item: '', amount: '', category: t.categories[0], note: '', date: todayDateStr });
  const [newWish, setNewWish] = useState({ title: '', price: '', level: 2 });
  
  // AI ÁãÄÊÖã
  const [aiText, setAiText] = useState('');
  const [isAiProcessing, setIsAiProcessing] = useState(false);

  // ÂàÜÊûêÈ†ÅÈù¢ÁãÄÊÖã
  const [analysisPreset, setAnalysisPreset] = useState('month'); // today, week, month, custom
  const [analysisDateRange, setAnalysisDateRange] = useState({
    start: new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0],
    end: todayDateStr
  });

  // ==========================================
  // 3. Ë™çË≠âËàáË≥áÊñôÁõ£ËÅΩ
  // ==========================================
  useEffect(() => {
    const initAuth = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (error) {
        console.error("Auth error:", error);
      }
    };
    initAuth();

    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
      setUser(currentUser);
      setIsLoading(false);
    });
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user) return;

    const expensesRef = collection(db, 'artifacts', appId, 'users', user.uid, 'expenses');
    const unsubExpenses = onSnapshot(expensesRef, (snapshot) => {
      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setExpenses(data.sort((a, b) => new Date(b.date) - new Date(a.date)));
    });

    const wishlistRef = collection(db, 'artifacts', appId, 'users', user.uid, 'wishlist');
    const unsubWishlist = onSnapshot(wishlistRef, (snapshot) => {
      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setWishlist(data);
    });

    const configRef = doc(db, 'artifacts', appId, 'users', user.uid, 'config', 'userConfig');
    const unsubConfig = onSnapshot(configRef, (docSnap) => {
      if (docSnap.exists()) {
        const dbConfig = docSnap.data();
        setConfig(prev => ({ ...prev, ...dbConfig }));
        // Êõ¥Êñ∞ÂàÜÈ°ûÈ†êË®≠ÂÄºÂ¶ÇÊûúË™ûË®ÄÊîπËÆä
        if (dbConfig.language && dbConfig.language !== config.language) {
           setNewExpense(prev => ({...prev, category: dict[dbConfig.language].categories[0]}));
        }
      }
    });

    return () => { unsubExpenses(); unsubWishlist(); unsubConfig(); };
  }, [user]);

  // ==========================================
  // 4. Ê•≠ÂãôÈÇèËºØËàáÊìç‰Ωú
  // ==========================================
  
  const handleAddExpense = async (e) => {
    e.preventDefault();
    if (!user || !newExpense.amount || !newExpense.item) return;
    try {
      await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'expenses'), {
        item: newExpense.item,
        amount: Number(newExpense.amount),
        category: newExpense.category,
        note: newExpense.note,
        date: newExpense.date,
        createdAt: new Date().toISOString()
      });
      setNewExpense({ ...newExpense, item: '', amount: '', note: '' });
    } catch (error) {
      console.error("Error adding expense:", error);
    }
  };

  const handleDeleteExpense = async (id) => {
    if (!user) return;
    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'expenses', id));
  };

  const handleAIEntry = async () => {
    if (!aiText.trim() || !user) return;
    setIsAiProcessing(true);
    try {
      const prompt = `
        Parse this expense input: "${aiText}".
        Current Date: ${todayDateStr}.
        Valid Categories: ${t.categories.join(', ')}.
        Return ONLY a JSON object with keys: "item" (string), "amount" (number), "category" (string, strictly match one of the valid categories), "date" (YYYY-MM-DD). Do not include markdown formatting or \`\`\`json.
      `;
      
      const payload = {
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: { responseMimeType: "application/json" }
      };

      const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
        method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload)
      });
      
      if (!res.ok) throw new Error("API request failed");
      const data = await res.json();
      const resultText = data.candidates?.[0]?.content?.parts?.[0]?.text;
      
      if (resultText) {
        const parsed = JSON.parse(resultText);
        await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'expenses'), {
          item: parsed.item || "AI Ë®òÂ∏≥",
          amount: Number(parsed.amount),
          category: t.categories.includes(parsed.category) ? parsed.category : t.categories[0],
          note: "Áî± AI Âª∫Á´ã",
          date: parsed.date || todayDateStr,
          createdAt: new Date().toISOString()
        });
        setAiText('');
      }
    } catch (error) {
      console.error("AI Parse Error:", error);
      alert("AI Ëß£ÊûêÂ§±ÊïóÔºåË´ãÊâãÂãïËº∏ÂÖ•ÊàñÈáçË©¶„ÄÇ");
    } finally {
      setIsAiProcessing(false);
    }
  };

  const saveConfig = async (newSettings) => {
    if (!user) return;
    const updated = { ...config, ...newSettings };
    setConfig(updated);
    try {
      await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'config', 'userConfig'), updated);
    } catch (error) {
      await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'config'), updated);
    }
  };

  // È°òÊúõÊ∏ÖÂñÆÊìç‰Ωú
  const handleAddWish = async (e) => {
    e.preventDefault();
    if (!user || !newWish.title || !newWish.price) return;
    await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'wishlist'), {
      title: newWish.title, price: Number(newWish.price), level: Number(newWish.level), isCompleted: false, createdAt: new Date().toISOString()
    });
    setNewWish({ title: '', price: '', level: 2 });
  };

  const handleToggleWish = async (id, currentStatus) => {
    if (!user) return;
    await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'wishlist', id), { isCompleted: !currentStatus });
  };

  const handleDeleteWish = async (id) => {
    if (!user) return;
    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'wishlist', id));
  };

  // ÁôªÂÖ•ÁôªÂá∫
  const handleGoogleLogin = async () => {
    try { await signInWithPopup(auth, new GoogleAuthProvider()); } catch (error) { console.error(error); }
  };
  const handleLogout = async () => {
    try { await signOut(auth); } catch (error) { console.error(error); }
  };

  // ==========================================
  // 5. Ë°çÁîüÊï∏ÊìöË®àÁÆóËàáÂúñË°®ËôïÁêÜ
  // ==========================================
  
  // Á¥ØÁ©çÁõàÈ§òËàá‰ªäÊó•È†êÁÆó
  const baseDateObj = new Date(config.baseDate);
  const todayObj = new Date(todayDateStr);
  const diffTime = Math.max(0, todayObj - baseDateObj);
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  // Á∏ΩÈ†êÁÆó (ÂæûËµ∑ÂßãÊó•Âà∞‰ªäÂ§©)
  const totalBudgetSinceBase = diffDays * config.dailyLimit;
  
  // ÂæûËµ∑ÂßãÊó•ÂæåÁöÑÊâÄÊúâËä±Ë≤ª
  const expensesSinceBase = expenses.filter(e => e.date >= config.baseDate);
  const totalSpentSinceBase = expensesSinceBase.reduce((sum, e) => sum + e.amount, 0);
  
  // Á¥ØÁ©çÂèØÁî®ÁõàÈ§ò = ÂàùÂßãÈ§òÈ°ç + ÊáâÊúâÁ∏ΩÈ†êÁÆó - Â∑≤Ëä±Ë≤ª
  const cumulativeSurplus = config.baseBalance + totalBudgetSinceBase - totalSpentSinceBase;

  // ‰ªäÊó•Ëä±Ë≤ª
  const todayExpenses = expenses.filter(e => e.date === todayDateStr);
  const todayTotal = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
  const todayRemaining = config.dailyLimit - todayTotal;

  // È°òÊúõÊ∏ÖÂñÆÁØ©ÈÅ∏
  const filteredWishlist = wishlist.filter(wish => activeTierFilters.includes(wish.level));

  // ÂàÜÊûêÂçÄÈñìÂø´ÈÄüË®≠ÂÆö
  const setPresetRange = (preset) => {
    setAnalysisPreset(preset);
    const end = todayDateStr;
    let start = end;
    const d = new Date();
    
    if (preset === 'week') {
      const day = d.getDay() || 7; 
      d.setDate(d.getDate() - day + 1);
      start = d.toISOString().split('T')[0];
    } else if (preset === 'month') {
      d.setDate(1);
      start = d.toISOString().split('T')[0];
    }
    setAnalysisDateRange({ start, end });
  };

  // Êï∏ÊìöÂàÜÊûêËôïÁêÜ
  const analysisData = useMemo(() => {
    const filtered = expenses.filter(e => e.date >= analysisDateRange.start && e.date <= analysisDateRange.end);
    const totalSpent = filtered.reduce((sum, e) => sum + e.amount, 0);
    
    // ÂàÜÈ°ûÈï∑Ê¢ùÂúñË≥áÊñô
    const byCategory = {};
    filtered.forEach(e => {
      byCategory[e.category] = (byCategory[e.category] || 0) + e.amount;
    });
    const categoryArray = Object.keys(byCategory).map(cat => ({
      name: cat, amount: byCategory[cat], percentage: totalSpent > 0 ? Math.round((byCategory[cat] / totalSpent) * 100) : 0
    })).sort((a, b) => b.amount - a.amount);

    // ÊØèÊó•ÊäòÁ∑öÂúñË≥áÊñô
    const byDate = {};
    filtered.forEach(e => {
      byDate[e.date] = (byDate[e.date] || 0) + e.amount;
    });
    const dateArray = Object.keys(byDate).sort().map(d => ({
      date: d, amount: byDate[d]
    }));
    
    const maxDaily = dateArray.length > 0 ? Math.max(...dateArray.map(d => d.amount)) : 0;

    return { totalSpent, categoryArray, dateArray, maxDaily, filtered };
  }, [expenses, analysisDateRange]);

  // ÊäòÁ∑öÂúñ SVG Path Áî¢Áîü
  const generateLinePath = () => {
    if (analysisData.dateArray.length === 0) return "";
    const pts = analysisData.dateArray.map((d, i) => {
      const x = (i / Math.max(1, analysisData.dateArray.length - 1)) * 100;
      const y = 100 - ((d.amount / analysisData.maxDaily) * 100);
      return `${x},${y}`;
    }).join(" ");
    return pts;
  };

  // ==========================================
  // 6. Ê∏≤ÊüìÁï´Èù¢
  // ==========================================
  if (isLoading) {
    return <div className="min-h-screen flex items-center justify-center bg-neutral-50 text-neutral-400">Loading...</div>;
  }

  return (
    <div className="min-h-screen bg-neutral-50 pb-24 font-sans text-neutral-800">
      
      {/* È†ÇÈÉ®Ê®ôÈ°å */}
      <header className="bg-white px-6 py-5 shadow-sm sticky top-0 z-10 flex justify-between items-center">
        <h1 className="text-xl font-bold text-neutral-800 tracking-wide">
          {config.nickname ? `${config.nickname} ÁöÑ${t.appTitle}` : t.appTitle}
        </h1>
        {activeTab === 'analysis' && <span className="text-sm font-medium text-neutral-400">{t.analysisTitle}</span>}
      </header>

      <main className="p-5 max-w-md mx-auto">
        
        {/* ================= HOME TAB ================= */}
        {activeTab === 'home' && (
          <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
            
            {/* ÁõàÈ§òËàáÈ†êÁÆóÂç°Áâá */}
            <div className="grid grid-cols-2 gap-4">
              <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-5 text-white shadow-md">
                <p className="text-xs text-indigo-100 mb-1">{t.cumulativeSurplus}</p>
                <p className="text-2xl font-bold">${cumulativeSurplus.toFixed(1)}</p>
                <p className="text-[10px] text-indigo-200 mt-2">‰æùË®≠ÂÆöËµ∑ÂßãÊó•Ë®àÁÆó</p>
              </div>
              <div className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100 flex flex-col justify-center">
                <p className="text-xs text-neutral-400 mb-1">{t.todayRemaining}</p>
                <p className={`text-2xl font-bold ${todayRemaining < 0 ? 'text-red-500' : 'text-neutral-800'}`}>
                  ${todayRemaining}
                </p>
                <p className="text-[10px] text-neutral-400 mt-2">{t.dailyBudget}: ${config.dailyLimit}</p>
              </div>
            </div>

            {/* AI Êô∫ËÉΩË®òÂ∏≥ÂçÄ */}
            <div className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100">
              <h2 className="text-sm font-bold text-neutral-700 mb-3">{t.aiEntryTitle}</h2>
              <div className="flex gap-2">
                <input type="text" 
                  className="flex-1 bg-neutral-50 border-none rounded-2xl px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-purple-200 transition-all" 
                  placeholder={t.aiPlaceholder}
                  value={aiText} onChange={e => setAiText(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && handleAIEntry()}
                />
                <button 
                  onClick={handleAIEntry} disabled={isAiProcessing || !aiText.trim()}
                  className={`px-4 py-2 rounded-2xl font-bold text-sm transition-all ${isAiProcessing ? 'bg-neutral-200 text-neutral-400' : 'bg-purple-100 text-purple-700 hover:bg-purple-200'}`}
                >
                  {isAiProcessing ? '...' : t.aiBtn}
                </button>
              </div>
            </div>

            {/* ÊâãÂãïË®òÂ∏≥ */}
            <div className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100">
              <h2 className="text-sm font-bold text-neutral-700 mb-4">{t.manualEntryTitle}</h2>
              <form onSubmit={handleAddExpense} className="space-y-4">
                <div className="flex gap-3">
                  <div className="flex-1">
                    <label className="block text-[10px] text-neutral-400 mb-1 ml-1">{t.itemName}</label>
                    <input type="text" required
                      className="w-full bg-neutral-50 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-100 text-sm font-medium" 
                      placeholder={t.itemName}
                      value={newExpense.item} onChange={e => setNewExpense({...newExpense, item: e.target.value})} 
                    />
                  </div>
                  <div className="w-[100px]">
                    <label className="block text-[10px] text-neutral-400 mb-1 ml-1">{t.amount}</label>
                    <input type="number" required
                      className="w-full bg-neutral-50 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-100 text-sm font-bold text-indigo-700" 
                      placeholder="0"
                      value={newExpense.amount} onChange={e => setNewExpense({...newExpense, amount: e.target.value})} 
                    />
                  </div>
                </div>
                
                <div className="flex gap-3">
                  <div className="w-2/5">
                    <label className="block text-[10px] text-neutral-400 mb-1 ml-1">{t.category}</label>
                    <select 
                      className="w-full bg-neutral-50 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-indigo-100 text-sm text-neutral-700"
                      value={newExpense.category} onChange={e => setNewExpense({...newExpense, category: e.target.value})}
                    >
                      {t.categories.map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                  </div>
                  <div className="flex-1">
                    <label className="block text-[10px] text-neutral-400 mb-1 ml-1">{t.note}</label>
                    <input type="text" 
                      className="w-full bg-neutral-50 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-100 text-sm" 
                      placeholder={t.note}
                      value={newExpense.note} onChange={e => setNewExpense({...newExpense, note: e.target.value})} 
                    />
                  </div>
                </div>
                
                <button type="submit" className="w-full bg-neutral-800 text-white rounded-xl py-3.5 font-bold text-sm hover:bg-neutral-700 active:scale-[0.98] transition-all shadow-sm">
                  {t.saveBtn}
                </button>
              </form>
            </div>

            {/* ‰ªäÊó•ÊòéÁ¥∞ */}
            {todayExpenses.length > 0 && (
              <div>
                <h2 className="text-sm font-bold text-neutral-500 mb-3 px-1">{t.todayDetails} (Â∑≤Ëä±: ${todayTotal})</h2>
                <div className="space-y-3">
                  {todayExpenses.map(expense => (
                    <div key={expense.id} className="bg-white p-4 rounded-2xl flex items-center justify-between shadow-sm border border-neutral-100">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center text-xs font-bold shrink-0">
                          {expense.category[0]}
                        </div>
                        <div className="min-w-0">
                          <p className="font-bold text-neutral-700 text-sm truncate">{expense.item}</p>
                          <div className="flex items-center gap-2 mt-0.5">
                            <span className="text-[10px] bg-neutral-100 text-neutral-500 px-1.5 py-0.5 rounded">{expense.category}</span>
                            {expense.note && <span className="text-[10px] text-neutral-400 truncate max-w-[100px]">{expense.note}</span>}
                          </div>
                        </div>
                      </div>
                      <div className="flex items-center gap-3 ml-2 shrink-0">
                        <span className="font-bold text-neutral-800">-${expense.amount}</span>
                        <button onClick={() => handleDeleteExpense(expense.id)} className="text-neutral-300 hover:text-red-400 transition-colors p-1">
                          <TrashIcon />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        )}

        {/* ================= WISHLIST TAB ================= */}
        {activeTab === 'wishlist' && (
          <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
            <form onSubmit={handleAddWish} className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100 mb-6 space-y-4">
              <div>
                <input type="text" required
                  className="w-full bg-neutral-50 rounded-2xl px-4 py-3 outline-none focus:ring-2 focus:ring-pink-200 transition-all text-sm mb-3" 
                  placeholder={t.wishDesc}
                  value={newWish.title} onChange={e => setNewWish({...newWish, title: e.target.value})} 
                />
                <input type="number" required
                  className="w-full bg-neutral-50 rounded-2xl px-4 py-3 outline-none focus:ring-2 focus:ring-pink-200 transition-all text-sm mb-4" 
                  placeholder={t.wishPrice}
                  value={newWish.price} onChange={e => setNewWish({...newWish, price: e.target.value})} 
                />
                
                <p className="text-xs text-neutral-500 mb-2 ml-1">{t.wishMeaning}</p>
                <div className="space-y-2 mb-4">
                  {t.wishTiers.map(tier => (
                    <label key={tier.level} 
                      className={`flex flex-col p-3 rounded-2xl border cursor-pointer transition-all ${
                        newWish.level === tier.level ? 'border-pink-300 bg-pink-50' : 'border-neutral-100 bg-white hover:bg-neutral-50'
                      }`}
                      onClick={() => setNewWish({...newWish, level: tier.level})}
                    >
                      <div className="flex items-center justify-between">
                        <span className="font-medium text-sm text-neutral-700">{tier.label}</span>
                        <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${newWish.level === tier.level ? 'border-pink-400' : 'border-neutral-300'}`}>
                          {newWish.level === tier.level && <div className="w-2 h-2 rounded-full bg-pink-400"></div>}
                        </div>
                      </div>
                      <span className="text-[10px] text-neutral-400 mt-1">{tier.desc}</span>
                    </label>
                  ))}
                </div>
              </div>
              <button type="submit" className="w-full bg-pink-500 text-white rounded-2xl py-3.5 font-bold text-sm hover:bg-pink-600 active:scale-[0.98] transition-all shadow-sm">
                {t.wishBtn}
              </button>
            </form>

            <div className="mb-4">
              <p className="text-xs text-neutral-400 mb-2 ml-1">{t.wishShowTier}</p>
              <div className="flex flex-wrap gap-2">
                {t.wishTiers.map(tier => {
                  const isActive = activeTierFilters.includes(tier.level);
                  return (
                    <button key={tier.level}
                      onClick={() => {
                        if (isActive) setActiveTierFilters(prev => prev.filter(l => l !== tier.level));
                        else setActiveTierFilters(prev => [...prev, tier.level]);
                      }}
                      className={`px-3 py-1.5 rounded-full text-[10px] font-medium transition-all border ${
                        isActive ? 'bg-neutral-700 text-white border-neutral-700' : 'bg-white text-neutral-400 border-neutral-200'
                      }`}
                    >
                      {isActive ? '‚úì ' : ''}{tier.label}
                    </button>
                  );
                })}
              </div>
            </div>

            <div className="space-y-3">
              {filteredWishlist.length === 0 ? (
                <div className="text-center py-10 text-neutral-400 text-sm bg-white rounded-3xl border border-neutral-100 border-dashed">
                  {t.wishEmpty}
                </div>
              ) : (
                filteredWishlist.sort((a,b) => a.level - b.level).map(wish => {
                  const currentTier = t.wishTiers.find(tier => tier.level === wish.level) || t.wishTiers[1];
                  return (
                    <div key={wish.id} className={`bg-white p-4 rounded-2xl flex items-center gap-4 shadow-sm border transition-all ${wish.isCompleted ? 'border-green-200 bg-green-50/50' : 'border-neutral-100'}`}>
                      <button 
                        onClick={() => handleToggleWish(wish.id, wish.isCompleted)}
                        className={`flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${wish.isCompleted ? 'border-green-500 bg-green-500 text-white' : 'border-neutral-300 text-transparent'}`}
                      >
                        <CheckIcon />
                      </button>
                      <div className="flex-1 min-w-0">
                        <span className="text-[10px] text-pink-500 font-medium">{currentTier.label.split(' ')[0]}</span>
                        <p className={`font-bold text-sm truncate mt-0.5 ${wish.isCompleted ? 'text-neutral-400 line-through' : 'text-neutral-700'}`}>{wish.title}</p>
                      </div>
                      <div className="text-right">
                        <p className={`text-sm ${wish.isCompleted ? 'text-neutral-300' : 'text-neutral-800 font-bold'}`}>${wish.price}</p>
                      </div>
                      <button onClick={() => handleDeleteWish(wish.id)} className="text-neutral-300 hover:text-red-400 ml-1">
                        <TrashIcon />
                      </button>
                    </div>
                  )
                })
              )}
            </div>
          </div>
        )}

        {/* ================= ANALYSIS TAB ================= */}
        {activeTab === 'analysis' && (
          <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
            
            {/* Âø´ÈÄüÈÅ∏ÊìáÂçÄÈñì */}
            <div className="flex gap-2 mb-2 overflow-x-auto pb-1 hide-scrollbar">
              {['today', 'week', 'month', 'custom'].map(preset => {
                const labels = { today: t.today, week: t.thisWeek, month: t.thisMonth, custom: t.customRange };
                return (
                  <button key={preset} 
                    onClick={() => preset === 'custom' ? setAnalysisPreset('custom') : setPresetRange(preset)}
                    className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all border ${
                      analysisPreset === preset ? 'bg-neutral-800 text-white border-neutral-800' : 'bg-white text-neutral-500 border-neutral-200 hover:bg-neutral-50'
                    }`}
                  >
                    {labels[preset]}
                  </button>
                )
              })}
            </div>

            {/* Ëá™Ë®ÇÂçÄÈñìÈÅ∏ÊìáÂô® */}
            {analysisPreset === 'custom' && (
              <div className="bg-white rounded-2xl p-4 shadow-sm border border-neutral-100 flex items-center gap-2 animate-in fade-in">
                <input type="date" value={analysisDateRange.start} onChange={(e) => setAnalysisDateRange(prev => ({...prev, start: e.target.value}))}
                  className="flex-1 bg-neutral-50 text-neutral-700 text-xs rounded-xl px-2 py-2 outline-none border border-neutral-200"
                />
                <span className="text-neutral-400 text-xs">{t.to}</span>
                <input type="date" value={analysisDateRange.end} onChange={(e) => setAnalysisDateRange(prev => ({...prev, end: e.target.value}))}
                  className="flex-1 bg-neutral-50 text-neutral-700 text-xs rounded-xl px-2 py-2 outline-none border border-neutral-200"
                />
              </div>
            )}

            {/* Á∏ΩËä±Ë≤ªÂç°Áâá */}
            <div className="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-3xl p-6 text-white shadow-md">
              <p className="text-emerald-100 text-sm font-medium mb-1">{t.totalSpentRange}</p>
              <p className="text-4xl font-bold">${analysisData.totalSpent}</p>
              <p className="text-xs text-emerald-100 mt-2 opacity-80">{analysisData.filtered.length} Á≠ÜÁ¥ÄÈåÑ</p>
            </div>

            {/* Èï∑Ê¢ùÂúñÔºöÂàÜÈ°ûÂç†ÊØî */}
            <div className="bg-white p-5 rounded-3xl shadow-sm border border-neutral-100">
              <h3 className="text-sm font-bold text-neutral-700 mb-4 flex items-center gap-2">
                <BarChartIcon /> {t.chartCategory}
              </h3>
              {analysisData.categoryArray.length === 0 ? (
                <p className="text-center text-xs text-neutral-400 py-4">ÁÑ°Ë≥áÊñô</p>
              ) : (
                <div className="space-y-3">
                  {analysisData.categoryArray.map(cat => (
                    <div key={cat.name}>
                      <div className="flex justify-between items-end mb-1">
                        <span className="text-xs font-bold text-neutral-700">{cat.name}</span>
                        <div className="text-right">
                          <span className="text-xs font-bold text-neutral-700">${cat.amount}</span>
                          <span className="text-[10px] text-neutral-400 ml-2">{cat.percentage}%</span>
                        </div>
                      </div>
                      <div className="w-full bg-neutral-100 rounded-full h-1.5 overflow-hidden">
                        <div className="bg-teal-400 h-1.5 rounded-full" style={{ width: `${cat.percentage}%` }}></div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* ÊäòÁ∑öÂúñÔºöÊØèÊó•Ë∂®Âã¢ */}
            <div className="bg-white p-5 rounded-3xl shadow-sm border border-neutral-100">
              <h3 className="text-sm font-bold text-neutral-700 mb-4 flex items-center gap-2">
                <LineChartIcon /> {t.chartTrend}
              </h3>
              {analysisData.dateArray.length === 0 ? (
                <p className="text-center text-xs text-neutral-400 py-4">ÁÑ°Ë≥áÊñô</p>
              ) : (
                <div className="relative h-32 w-full mt-4 border-b border-l border-neutral-200">
                  <svg className="w-full h-full overflow-visible" preserveAspectRatio="none" viewBox="0 0 100 100">
                    <polyline
                      fill="none" stroke="#2dd4bf" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                      points={generateLinePath()}
                    />
                    {/* Êï∏ÊìöÈªû */}
                    {analysisData.dateArray.map((d, i) => {
                      const x = (i / Math.max(1, analysisData.dateArray.length - 1)) * 100;
                      const y = 100 - ((d.amount / analysisData.maxDaily) * 100);
                      return <circle key={i} cx={x} cy={y} r="1.5" fill="#0f766e" />;
                    })}
                  </svg>
                  {/* YËª∏Ê®ôÁ±§ */}
                  <div className="absolute top-0 -left-1 transform -translate-x-full text-[8px] text-neutral-400">${analysisData.maxDaily}</div>
                  <div className="absolute bottom-0 -left-1 transform -translate-x-full translate-y-1/2 text-[8px] text-neutral-400">$0</div>
                </div>
              )}
            </div>

          </div>
        )}

        {/* ================= SETTINGS TAB ================= */}
        {activeTab === 'settings' && (
          <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
            
            {/* Âü∫Êú¨Ë®≠ÂÆö */}
            <div className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100 space-y-4">
              <div>
                <label className="block text-xs font-bold text-neutral-700 mb-1.5">{t.nickname}</label>
                <input type="text" 
                  className="w-full bg-neutral-50 rounded-xl px-4 py-2.5 outline-none focus:ring-2 focus:ring-neutral-200 text-sm border border-transparent" 
                  value={config.nickname || ''} placeholder="Ë®≠ÂÆöÊÇ®ÁöÑÁ®±Âëº"
                  onChange={e => setConfig({...config, nickname: e.target.value})} 
                  onBlur={(e) => saveConfig({nickname: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-xs font-bold text-neutral-700 mb-1.5">{t.dailyBudget} ($)</label>
                <input type="number" 
                  className="w-full bg-neutral-50 rounded-xl px-4 py-2.5 outline-none focus:ring-2 focus:ring-neutral-200 text-sm font-medium border border-transparent" 
                  value={config.dailyLimit} 
                  onChange={e => setConfig({...config, dailyLimit: Number(e.target.value)})} 
                  onBlur={(e) => saveConfig({dailyLimit: Number(e.target.value)})}
                />
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-[10px] text-neutral-500 mb-1">{t.baseDate}</label>
                  <input type="date" 
                    className="w-full bg-neutral-50 rounded-xl px-3 py-2 outline-none focus:ring-2 focus:ring-neutral-200 text-xs border border-transparent" 
                    value={config.baseDate} 
                    onChange={e => setConfig({...config, baseDate: e.target.value})} 
                    onBlur={(e) => saveConfig({baseDate: e.target.value})}
                  />
                </div>
                <div>
                  <label className="block text-[10px] text-neutral-500 mb-1">{t.baseBalance}</label>
                  <input type="number" 
                    className="w-full bg-neutral-50 rounded-xl px-3 py-2 outline-none focus:ring-2 focus:ring-neutral-200 text-xs border border-transparent" 
                    value={config.baseBalance} 
                    onChange={e => setConfig({...config, baseBalance: Number(e.target.value)})} 
                    onBlur={(e) => saveConfig({baseBalance: Number(e.target.value)})}
                  />
                </div>
              </div>
            </div>

            {/* Á≥ªÁµ±Ë®≠ÂÆö */}
            <div className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100">
              <label className="block text-xs font-bold text-neutral-700 mb-2">{t.langSelect}</label>
              <div className="flex bg-neutral-100 rounded-xl p-1">
                <button 
                  onClick={() => saveConfig({language: 'zh'})}
                  className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${config.language === 'zh' ? 'bg-white shadow-sm text-neutral-800' : 'text-neutral-400 hover:text-neutral-600'}`}
                >‰∏≠Êñá (ÁπÅ)</button>
                <button 
                  onClick={() => saveConfig({language: 'en'})}
                  className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${config.language === 'en' ? 'bg-white shadow-sm text-neutral-800' : 'text-neutral-400 hover:text-neutral-600'}`}
                >English</button>
              </div>
            </div>

            {/* Â∏≥ËôüËàáÂÇô‰ªΩ */}
            <div className="bg-white rounded-3xl p-5 shadow-sm border border-neutral-100">
              <h3 className="text-sm font-bold text-neutral-700 mb-4">{t.cloudBackup}</h3>
              <div className="flex items-center gap-4 mb-6 bg-neutral-50 p-3 rounded-2xl">
                {user?.photoURL ? (
                  <img src={user.photoURL} className="w-10 h-10 rounded-full shadow-sm" alt="user avatar"/>
                ) : (
                  <div className="w-10 h-10 rounded-full bg-neutral-200 flex items-center justify-center text-neutral-400">
                    <UserIcon />
                  </div>
                )}
                <div className="flex-1 overflow-hidden">
                  <p className="text-sm font-bold text-neutral-700 truncate">
                    {user?.isAnonymous ? t.guest : (user?.displayName || "User")}
                  </p>
                  <p className="text-[10px] text-neutral-500 truncate">
                    {user?.isAnonymous ? t.localOnly : user?.email}
                  </p>
                </div>
              </div>

              {user?.isAnonymous ? (
                <button onClick={handleGoogleLogin} className="w-full py-3 bg-neutral-800 text-white font-bold text-sm rounded-xl shadow-sm hover:bg-neutral-700 transition-all flex items-center justify-center gap-2">
                  <GoogleIcon /> {t.loginGoogle}
                </button>
              ) : (
                <button onClick={handleLogout} className="w-full py-3 bg-rose-50 text-rose-600 font-bold text-sm rounded-xl hover:bg-rose-100 transition-all">
                  {t.logout}
                </button>
              )}
            </div>
          </div>
        )}
      </main>

      {/* Â∫ïÈÉ®Â∞éËà™Âàó */}
      <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-neutral-100 pb-safe z-20">
        <div className="max-w-md mx-auto flex justify-around items-center p-2">
          <NavButton active={activeTab === 'home'} onClick={() => setActiveTab('home')} icon={<HomeIcon />} label={t.home} />
          <NavButton active={activeTab === 'wishlist'} onClick={() => setActiveTab('wishlist')} icon={<HeartIcon />} label={t.wishlist} />
          <NavButton active={activeTab === 'analysis'} onClick={() => setActiveTab('analysis')} icon={<PieChartIcon />} label={t.analysis} />
          <NavButton active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} icon={<SettingsIcon />} label={t.settings} />
        </div>
      </nav>
    </div>
  );
}

// ==========================================
// 7. UI ÂÖÉ‰ª∂Ëàá Icons
// ==========================================

function NavButton({ active, onClick, icon, label }) {
  return (
    <button 
      onClick={onClick} 
      className={`flex flex-col items-center gap-1 p-2 w-16 transition-all ${active ? 'text-neutral-800' : 'text-neutral-400 hover:text-neutral-600'}`}
    >
      <div className={`transition-all ${active ? 'stroke-[2.5px] scale-110' : 'stroke-[2px]'}`}>
        {icon}
      </div>
      {/* ‰øÆÊîπËôïÔºöÊñáÂ≠óÂßãÁµÇÂèØË¶ãÔºåÈÅ∏‰∏≠ÊôÇËÆäËâ≤‰∏îÂä†Á≤ó */}
      <span className={`text-[10px] font-medium transition-all ${active ? 'opacity-100 font-bold' : 'opacity-70'}`}>{label}</span>
    </button>
  );
}

// Inline SVGs
const HomeIcon = () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
const HeartIcon = () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>;
const PieChartIcon = () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>;
const SettingsIcon = () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
const TrashIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>;
const CheckIcon = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
const UserIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
const GoogleIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>;
const BarChartIcon = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-4"/></svg>;
const LineChartIcon = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>;
        // =======================================================================================

        import React, { useState, useEffect, useMemo } from 'react';
        import { initializeApp } from 'firebase/app';
        import { getAnalytics } from "firebase/analytics";
        import { 
          getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged,
          GoogleAuthProvider, signInWithPopup, signOut
        } from 'firebase/auth';
        import { 
          getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc
        } from 'firebase/firestore';

        const firebaseConfig = {
          apiKey: "AIzaSyD5iLIBqMK__fqyRUObXnO9S55Rne0gQnY",
          authDomain: "my-savings-app-138fd.firebaseapp.com",
          projectId: "my-savings-app-138fd",
          storageBucket: "my-savings-app-138fd.firebasestorage.app",
          messagingSenderId: "610693434561",
          appId: "1:610693434561:web:00221b38ee48d3cb875840",
          measurementId: "G-4FV1FGDX28"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

      
        // -------------------------------------------------------------------

        // =======================================================================================
        // MOUNTING LOGIC
        // If your main application component is named something other than "App" 
        // (for example: "SaveMoneyApp"), please update the name inside <App /> below.
        // =======================================================================================
        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = createRoot(rootElement);
            root.render(<App />);
        }
    </script>
</body>
</html>
